-- cave divers whe- üï≥Ô∏è

local runService = game:GetService("RunService")
local player = game.Players.LocalPlayer

local isPaused = false
local isStopped = false
local cooldown = false

-- GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Parent = cloneref(game:GetService("CoreGui"))

local button = Instance.new("TextButton")
button.Parent = screenGui
button.Size = UDim2.new(0, 120, 0, 50)
button.Position = UDim2.new(0.8, -110, 0.4, -25)
button.Text = "Do Generator"
button.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
button.TextColor3 = Color3.new(1, 1, 1)
button.Draggable = true
button.Active = true

-- accwait
local function accwait(duration)
    if not duration or duration <= 0 then return end
    local start = os.clock()
    local conn
    conn = runService.PreRender:Connect(function()
        if isStopped then conn:Disconnect() end
    end)
    while os.clock() - start < duration do
        if isStopped then
            conn:Disconnect()
            return
        end
        while isPaused and not isStopped do
            runService.PreRender:Wait()
        end
        runService.PreRender:Wait()
    end
    conn:Disconnect()
end

-- VAR UNTUK GENERATOR YANG KITA INTERACT
local currentGen = nil

-- Hook setiap kali kita invoke remote "enter" ‚Üí berarti kita interact generator
for _, map in pairs(workspace:WaitForChild("Map"):WaitForChild("Ingame"):GetChildren()) do
    if map:IsA("Model") and map.Name == "Map" then
        for _, gen in pairs(map:GetChildren()) do
            if gen:IsA("Model") and gen.Name == "Generator" and gen:FindFirstChild("Remotes") then
                local remotes = gen.Remotes
                local rf = remotes:WaitForChild("RF")

                -- Wrap original function
                local oldInvokeServer
                oldInvokeServer = hookfunction(rf.InvokeServer, function(self, ...)
                    local args = {...}
                    if tostring(args[1]) == "enter" then
                        currentGen = gen
                    end
                    return oldInvokeServer(self, unpack(args))
                end)
            end
        end
    end
end

-- Tombol ditekan
button.MouseButton1Click:Connect(function()
    if cooldown then return end
    cooldown = true 
    button.Text = "Cooldown"

    if currentGen then
        local remotes = currentGen:WaitForChild("Remotes")
        remotes:WaitForChild("RF"):InvokeServer("enter")
        remotes:WaitForChild("RE"):FireServer()
        accwait(0.1)
        remotes:WaitForChild("RF"):InvokeServer("leave")
    else
        warn("Belum ada generator yang di-interact!")
    end

    accwait(0.9)
    button.Text = "Do Generator"
    cooldown = false 
end)
